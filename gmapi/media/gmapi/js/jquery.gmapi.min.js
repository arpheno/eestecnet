(function (f) {
    function p(a, b) {
        function c() {
            return a.apply(this, b)
        }

        c.prototype = a.prototype;
        return new c
    }

    function i(a, b) {
        b = b || window.google.maps;
        a = a.split(".");
        if (a[0]in b)return a.length > 1 ? i(a.slice(1).join("."), b[a[0]]) : b[a[0]]; else throw Error(a[0] + " not found!");
    }

    function q(a, b) {
        a.openInfoWindow = function () {
            a instanceof google.maps.Marker ? b.open(a.getMap(), a) : b.open(a)
        };
        a.closeInfoWindow = function () {
            b.close()
        };
        a.getInfoWindow = function () {
            return b
        };
        if (a instanceof google.maps.Marker)b.getMarker = function () {
            return a
        }
    }

    function r(a, b) {
        for (e in b)(function (c, d, g) {
            var j = function () {
                i(d, window).apply(this, arguments)
            };
            g ? google.maps.event.addListenerOnce(a, c, j) : google.maps.event.addListener(a, c, j)
        }).apply(this, b[e])
    }

    function h(a, b) {
        if (a === "div")return b;
        if (f.isPlainObject(a) || f.isArray(a)) {
            if (a.cls) {
                var c = [];
                if (a.arg)for (var d in a.arg)c.push(h(a.arg[d], b));
                d = p(i(a.cls), c);
                a.nfo && q(d, h(a.nfo, b));
                a.evt && r(d, a.evt);
                return d
            }
            if (a.val)return i(a.val);
            for (c in a)a[c] = h(a[c], b)
        }
        return a
    }

    function k(a) {
        var b = new google.maps.LatLngBounds;
        if (a instanceof google.maps.MVCArray || f.isArray(a) || f.isPlainObject(a))for (var c in a)b.union(k(a[c])); else if (a instanceof google.maps.LatLng)b.extend(a); else if (a instanceof google.maps.Marker)b.extend(a.getPosition()); else if (a instanceof google.maps.Polyline)b.union(k(a.getPath())); else a instanceof google.maps.Polygon && b.union(k(a.getPaths()));
        return b
    }

    function l(a) {
        return function () {
            var b = f(this), c = b.data(a);
            for (var d in c)c[d].setMap(null);
            b.removeData(a)
        }
    }

    function m(a, b) {
        return function () {
            if (b) {
                var c =
                    f(this), d = c.data("map"), g = c.data(a) || [];
                for (var j in b) {
                    var o = h(b[j], this);
                    o.setMap(d);
                    g.push(o)
                }
                c.data(a, g)
            }
        }
    }

    function n(a, b) {
        return function () {
            var c = f(this), d = c.data("map");
            c = c.data(a);
            if (d && c) {
                c = k(c);
                if (b >= 0) {
                    d.setZoom(b);
                    d.setCenter(c.getCenter())
                } else d.fitBounds(c)
            }
        }
    }

    f.fn.extend({
        removeMarkers: function () {
            return this.each(l("markers"))
        }, removePolylines: function () {
            return this.each(l("polylines"))
        }, removePolygons: function () {
            return this.each(l("polygons"))
        }, addMarkers: function (a) {
            return this.each(m("markers",
                a))
        }, addPolylines: function (a) {
            return this.each(m("polylines", a))
        }, addPolygons: function (a) {
            return this.each(m("polygons", a))
        }, fitMarkers: function (a) {
            return this.each(n("markers", a))
        }, fitPolylines: function (a) {
            return this.each(n("polylines", a))
        }, fitPolygons: function (a) {
            return this.each(n("polygons", a))
        }, getMarkers: function () {
            return this.data("markers")
        }, getPolylines: function () {
            return this.data("polylines")
        }, getPolygons: function () {
            return this.data("polygons")
        }, getMap: function () {
            return this.data("map")
        },
        applyMap: function (a) {
            var b = [];
            b.mkr = "markers";
            b.pln = "polylines";
            b.pgn = "polygons";
            return this.each(function () {
                var c = f(this);
                for (var d in b)l(b[d]).call(this);
                c.removeData("map");
                var g = h(a, c.children("div")[0]);
                c.data("map", g);
                for (d in b)if (d in a) {
                    m(b[d], a[d]).call(this);
                    g.getCenter() || n(b[d], g.getZoom()).call(this)
                }
            })
        }, initMap: function () {
            return this.each(function () {
                var a = f(this), b = a.children("div"), c = (b.attr("class").match(/{.*}/) || [])[0];
                if (c) {
                    b.removeClass();
                    a.applyMap(f.parseJSON(c));
                    var d = a.children("img");
                    google.maps.event.addListenerOnce(a.data("map"), "tilesloaded", function () {
                        d.css("z-index", -1)
                    })
                }
            })
        }
    });
    f(function () {
        f("div.gmap:visible").initMap()
    })
})(jQuery || django.jQuery);
